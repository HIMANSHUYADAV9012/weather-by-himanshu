<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HawabaaziЁЯШЕ тШБя╕П | By Himanshu Yadav</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-fadeIn {
        animation: fadeIn 0.6s ease-in-out;
      }

      #suggestions {
        position: absolute;
        z-index: 50;
        background: white;
        width: 100%;
        border-radius: 0.5rem;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        overflow: auto;
        max-height: 200px;
      }
      #suggestions div {
        padding: 0.5rem 1rem;
        cursor: pointer;
      }
      #suggestions div:hover {
        background-color: #e2e8f0;
      }

      .himanshu-bubble {
        position: relative;
        background: #f8fafc;
        border-radius: 1rem;
        padding: 1rem;
        margin-top: 1rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .himanshu-bubble:after {
        content: "";
        position: absolute;
        top: -10px;
        left: 20px;
        border-width: 0 10px 10px;
        border-style: solid;
        border-color: #f8fafc transparent;
      }

      /* Music player styles */
      #musicPlayer {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        border-radius: 50px;
        padding: 8px 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: 10px;
        z-index: 1000;
        transition: all 0.3s ease;
      }
      #musicPlayer:hover {
        background: rgba(255, 255, 255, 0.95);
      }
      #musicControl {
        background: none;
        border: none;
        font-size: 1.2rem;
        cursor: pointer;
        color: #3b82f6;
        transition: transform 0.2s;
      }
      #musicControl:hover {
        transform: scale(1.1);
      }
      #musicInfo {
        font-size: 0.8rem;
        color: #333;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 0;
        transition: max-width 0.3s ease;
      }
      #musicPlayer:hover #musicInfo {
        max-width: 200px;
      }
    </style>
  </head>
  <body
    class="bg-gradient-to-br from-blue-100 via-blue-200 to-blue-300 min-h-screen flex flex-col items-center px-4 py-10 transition-all duration-500 font-sans"
  >
    <div class="text-center w-full max-w-lg">
      <h1
        class="text-5xl font-extrabold mb-6 text-blue-900 drop-shadow-md tracking-wide"
      >
        тЫЕHawaBaazi
      </h1>

      <!-- Input + Suggestions -->
      <div class="relative w-full md:w-96 mx-auto mb-6 group">
        <div
          class="relative bg-white/30 backdrop-blur-lg border border-white/50 rounded-xl shadow-xl transition-all duration-300 focus-within:ring-2 focus-within:ring-blue-400"
        >
          <input
            id="locationInput"
            type="text"
            oninput="autoSuggest(this.value)"
            placeholder="ЁЯМЖ Apna sheher daalo yaar..."
            class="peer px-5 py-3 w-full bg-transparent rounded-xl focus:outline-none text-lg text-gray-800 placeholder-gray-700 font-medium transition-all duration-300 tracking-wide"
          />
          <!-- Voice Search Button -->
          <button
            onclick="startVoice()"
            class="absolute right-3 top-1/2 -translate-y-1/2 text-blue-600 hover:text-blue-800 text-xl transition-transform hover:scale-110"
            title="Voice Search"
          >
            <i class="fas fa-microphone"></i>
          </button>
        </div>
        <div id="suggestions" class="hidden mt-1 z-50"></div>
      </div>

      <!-- Animated Button -->
      <button
        id="checkBtn"
        onclick="getWeather()"
        class="mb-6 px-7 py-3 rounded-full bg-gradient-to-r from-blue-500 via-indigo-500 to-blue-600 hover:from-indigo-600 hover:to-blue-700 transition-all duration-300 text-white font-bold shadow-lg shadow-blue-300/50 hover:shadow-xl hover:scale-105"
      >
        <i class="fas fa-cloud-sun mr-2 animate-pulse"></i> Pata Karo Mausam Ka!
      </button>

      <!-- Search History -->
      <div id="history" class="flex flex-wrap gap-2 justify-center mb-6"></div>

      <!-- Weather Info -->
      <div id="weatherInfo" class="w-full"></div>
    </div>

    <!-- Music Player (initially hidden) -->
    <div id="musicPlayer" style="display: none">
      <button id="musicControl" onclick="toggleMusic()">
        <i class="fas fa-play"></i>
      </button>
      <span id="musicInfo">Weather Music</span>
    </div>

    <!-- Footer -->
    <footer
      class="mt-10 bg-white/30 backdrop-blur-md rounded-2xl p-5 shadow-xl w-full max-w-md animate-fadeIn"
    >
      <div class="flex flex-col items-center gap-3 text-center">
        <h3 class="text-xl font-semibold text-gray-800">
          Designed with тЭдя╕П by Himanshu Yadav
        </h3>

        <div class="flex flex-wrap justify-center gap-4 mt-2">
          <a
            href="https://instagram.com/himanshu_yadav479"
            target="_blank"
            class="flex items-center gap-2 px-4 py-1.5 bg-pink-100 rounded-full hover:bg-pink-200 transition"
          >
            <i
              class="fab fa-instagram text-pink-600 text-lg hover:scale-125 duration-300"
            ></i>
            <span class="text-sm font-medium text-gray-800">Instagram</span>
          </a>
          <a
            href="https://wa.me/918534866350"
            target="_blank"
            class="flex items-center gap-2 px-4 py-1.5 bg-green-100 rounded-full hover:bg-green-200 transition"
          >
            <i
              class="fab fa-whatsapp text-green-600 text-lg hover:scale-125 duration-300"
            ></i>
            <span class="text-sm font-medium text-gray-800">WhatsApp</span>
          </a>
        </div>

        <a
          href="tel:+918534866350"
          class="flex items-center gap-2 px-4 py-1.5 bg-blue-100 rounded-full hover:bg-blue-200 transition"
        >
          <i
            class="fas fa-phone-alt text-blue-600 text-sm hover:scale-125 duration-300"
          ></i>
          <span class="text-sm font-medium text-gray-800">Call Me</span>
        </a>

        <a
          href="mailto:azp729012@gmail.com"
          class="text-xs text-blue-700 underline hover:text-blue-900 transition"
          >Send Feedback</a
        >

        <p class="text-sm text-gray-600 mt-2">
          ┬й <span id="year"></span> All Rights Reserved
        </p>
      </div>
    </footer>

    <script>
      // Weather activities suggestions
    // Family-friendly & funny activity suggestions based on weather
const weatherActivities = {
  sunny: [
    "тШАя╕П Aaj ka sun toh celebrity mood mein hai тАУ sunglasses mandatory! ЁЯШО",
    "ЁЯН╣ Mummy ke haath ka aam panna sabko serve karo, chilled vibes! тЭДя╕П",
    "ЁЯз║ Terrace pe bedsheet bichhao, ghar wala picnic shuru karo!",
    "ЁЯТж Baccho ke рд▓рд┐рдП inflatable mini pool setup karo тАУ pool party at home!",
    "ЁЯОи Rangoli ya chalk se terrace decorate karo тАУ insta reels ke рд▓рд┐рдП perfect!",
    "ЁЯУЦ Veranda рдореЗрдВ рдмреИрдардХрд░ dadi-nani рд╕реЗ рдкреБрд░рд╛рдиреА рдХрд╣рд╛рдирд┐рдпрд╛рдБ рд╕реБрдиреЛ!",
    "ЁЯНж Ice cream bar рдмрдирд╛рдУ ghar mein тАУ toppings unlimited!",
    "ЁЯСТ Mummy-рдкрд╛рдкрд╛ ke рд╕рд╛рде matching summer hats рдкрд╣рдиреЛ!",
    "ЁЯСг Barefoot terrace walk тАУ thoda earthing bhi ho рдЬрд╛рдП!",
    "ЁЯкБ Bacchon ke рд╕рд╛рде рдкрддрдВрдЧ рдЙрдбрд╝рд╛рдУ, sunny sky mein colors рднрд░ рджреЛ!",
    "ЁЯО╢ Outdoor Bluetooth speaker рд▓рдЧрд╛рдУ, sabka dance mood on рдХрд░реЛ!",
    "ЁЯПЦя╕П Sunbathing mat bichhao aur Vitamin-D party рд░рдЦреЛ!",
    "ЁЯз╝ Baccho рдХреЗ рд╕рд╛рде car wash game рдЦреЗрд▓реЛ, sabko рдордЬрд╝рд╛ рдЖрдПрдЧрд╛!",
    "ЁЯНН Tropical fruit salad рдмрдирд╛рдУ aur sab milke enjoy рдХрд░реЛ!",
    "ЁЯОе Garden рдореЗрдВ sheet рд▓рдЧрд╛рдХреЗ mini movie screening рд░рдЦреЛ!",
    "ЁЯУ╖ Sunny filter рдореЗрдВ sabka photoshoot рдХрд░реЛ!",
    "ЁЯМ╝ Ghar рдХреЗ plants рдХреЛ рдкрд╛рдиреА рджреЛ aur unse рдмрд╛рдд рдХрд░реЛ тАУ nature bonding!",
    "ЁЯР╢ Pet ke рд╕рд╛рде lawn рдореЗрдВ fetch рдЦреЗрд▓реЛ!",
    "ЁЯНЙ Watermelon cutting contest rakho тАУ sabke рд╣рд┐рд╕реНрд╕реЗ рдореЗрдВ рдПрдХ slice!",
    "ЁЯзГ Sab milke ek giant lemonade pitcher рдмрдирд╛рдУ тАУ cheers bolo! ЁЯеВ"
  ],
  rainy: [
    "тШФ Window рдХреЗ рдкрд╛рд╕ рдмреИрдареЛ aur barish ke рд╕рд╛рде pakoda party рд╢реБрд░реВ рдХрд░реЛ!",
    "ЁЯН╡ Mummy ke haath ki masala chai sabko serve рдХрд░реЛ!",
    "ЁЯСг Papa рдХреЗ рд╕рд╛рде umbrella рд▓реЗрдХрд░ rainy walk рдХрд░реЛ!",
    "ЁЯШ┤ Rain sound playlist on рдХрд░реЛ aur power nap рд▓реЛ!",
    "тЫ╡ Kids рдХреЗ рд╕рд╛рде paper boat рдмрдирд╛ рдХреЗ balcony рдореЗрдВ рдЪрд▓рд╛рдУ!",
    "ЁЯО╡ тАШTip Tip Barsa PaniтАЩ рд╡рд╛рд▓рд╛ dance karo тАУ sab milke!",
    "ЁЯМ╜ Bhutta рд╕реЗрдХрдиреЗ рдХрд╛ competition рд░рдЦреЛ тАУ sabko apna flavour рдЪреБрдирдиреЗ рджреЛ!",
    "ЁЯЦНя╕П Baccho рдХреЗ рд▓рд┐рдП тАШDraw the RainтАЩ competition рд░рдЦреЛ!",
    "ЁЯУ╕ Rainy-day look рдореЗрдВ family reel shoot рдХрд░реЛ!",
    "ЁЯОд Purani romantic songs рдЧрд╛рдУ, Bollywood рд╡рд╛рд▓реА feel ke рд╕рд╛рде!",
    "ЁЯО▓ Indoor games like Uno, Ludo aur Jenga nikalo!",
    "ЁЯНк Rainy cookie baking session rakho sabke рд╕рд╛рде!",
    "ЁЯУЪ Baccho рдХреЛ barish wali kahani sunрд╛рдУ тАУ imagination рдЙрдбрд╝рдиреЗ рджреЛ!",
    "ЁЯТГ Mini dance-off rakho тАУ рдмрд╛рд░рд┐рд╢ рдФрд░ beats рджреЛрдиреЛ рд╕рд╛рде!",
    "ЁЯз╜ Rain ke рдмрд╣рд╛рдиреЗ car рд╕рд╛рдл рдХрд░ рд▓реЛ тАУ рдордЬрд╝рд╛ рднреА kaam рднреА!",
    "ЁЯФж Torch leke dark corner treasure hunt рдХрд░реЛ!",
    "ЁЯе│ Rainy snacks party рдХрд░реЛ тАУ рд╣рд░ рдХрд┐рд╕реА рдХреА рдкрд╕рдВрдж рдХреА рдЪреАрдЬрд╝!",
    "ЁЯОм Bollywood rainy movie marathon rakho тАУ popcorn ready!",
    "ЁЯз╡ Mummy рд╕реЗ рд╕реАрдирд╛ рд╕рд┐рдЦреЛ тАУ рд╣рд╛рде рд╕реЗ рдПрдХ рдЫреЛрдЯреА рдЪреАреЫ рдмрдирд╛рдУ!",
    "ЁЯТМ Barish wali yaadon рдХрд╛ scrap-book banao тАУ creativity time!"
  ],
  cloudy: [
    "тШБя╕П Sky pe itne badal hain jaise God ne cotton рдлреЗрдВрдХ рджреА рд╣реЛ!",
    "ЁЯПЮя╕П Park chalo with family тАУ perfect weather walk рдХреЗ рд▓рд┐рдП!",
    "ЁЯСА Baccho рдХреЗ рд╕рд╛рде cloud shapes рдкрд╣рдЪрд╛рдирдиреЗ рдХрд╛ game рдЦреЗрд▓реЛ!",
    "ЁЯП╕ Sun рдирд╣реАрдВ рд╣реИ toh badminton ka рдордЬрд╝рд╛ double!",
    "ЁЯН▒ Ghar рдореЗрдВ chhoti si indoor picnic рдХрд░реЛ mat bichake!",
    "ЁЯУ╕ Cloudy photoshoot рдХрд░реЛ, insta-worthy background рдорд┐рд▓реЗрдЧрд╛!",
    "ЁЯУЪ Story time rakho тАУ mummy/dadi рдХреА best stories!",
    "ЁЯО▓ Papa ke рд╕рд╛рде chess рдпрд╛ carrom рдЦреЗрд▓рдиреЗ рдХрд╛ challenge рд░рдЦреЛ!",
    "ЁЯНЭ Sab milke ek fav dish рдмрдирд╛рдУ aur serve рдХрд░реЛ restaurant style!",
    "ЁЯШВ Jokes session rakho тАУ рд╣рд░ рдХреЛрдИ ek funny joke рд╕реБрдирд╛рдП!",
    "ЁЯОо Cloudy day gaming tournament тАУ PS рдпрд╛ mobile sab chalta hai!",
    "ЁЯОи Painting time тАУ after all, mood cloudy рд╣реИ рдкрд░ creativity bright!",
    "ЁЯкБ Baccho рдХреЗ рд╕рд╛рде paper kite рдмрдирд╛рдУ рдФрд░ рдЙрдбрд╝рд╛рдУ!",
    "тШХ Cloud watching ke рд╕рд╛рде chai and samosa combo ready рд░рдЦреЛ!",
    "ЁЯОн Mini family drama act рдХрд░реЛ тАУ stage cloudy vibe wala!",
    "ЁЯФн Telescope рдпрд╛ binoculars рд╕реЗ sky observe рдХрд░реЛ!",
    "ЁЯОд Antakshari рдХрд░реЛ тАУ theme тАШsky & cloudsтАЩ songs!",
    "ЁЯЫЛя╕П Sofa pe sab ek рд╕рд╛рде рдмреИрдардХрд░ family рдлрдиреА memory рд╢реЗрдпрд░ рдХрд░реЛ!",
    "ЁЯзГ Cloudy cooler рдмрдирд╛рдУ тАУ mint lemonade, rose sharbat!",
    "ЁЯТМ Cloud mood рдкрд░ рдПрдХ family letter likho future рдХреЗ рд▓рд┐рдП!"
  ],
  cold: [
    "ЁЯФе Ghar ka рд╣реАрдЯрд░ ya angeethi рдХреЗ рдкрд╛рд╕ family jam session rakho!",
    "ЁЯНо Garam halwa ya gajar ka halwa sab milke banao aur рдЦрд╛рдУ!",
    "ЁЯЫПя╕П Blanket fort рдмрдирд╛рдУ aur рдЕрдВрджрд░ movie night рд░рдЦреЛ!",
    "ЁЯзд Baccho ke рд▓рд┐рдП woolen dress-up contest rakho!",
    "ЁЯзж Mummy рд╕реЗ unki cozy socks рдорд╛рдБрдЧреЛ aur рдкрд╣рдиреЛ with chai!",
    "ЁЯУЦ Fireplace vibes рдореЗрдВ story reading рд░рдЦреЛ тАУ papa рдмреЛрд▓реЗ aur sab рд╕реБрдиреЗрдВ!",
    "ЁЯНЬ Soup ke рдЕрд▓рдЧ-рдЕрд▓рдЧ flavour try karo тАУ tasting challenge rakho!",
    "ЁЯОз Chill music lagao aur sab milрдХреЗ peaceful time рд▓реЛ!",
    "ЁЯзй Puzzle solving session rakho with hot cocoa!",
    "ЁЯОи Wool craft workshop ghar рдореЗрдВ рд╣реА рд░рдЦ рд▓реЛ!",
    "ЁЯзЛ Kulhad wali chai sab рдорд┐рд▓рдХреЗ market рд╕реЗ рд▓рд╛рдУ aur enjoy рдХрд░реЛ!",
    "ЁЯУ╕ Winter outfits рдореЗрдВ family рдХреА funny reel рдмрдирд╛рдУ!",
    "ЁЯНХ Oven-based pizza banрд╛рдУ тАУ home-made cheesy delight!",
    "ЁЯОд Karaoke session rakho тАУ winter blues рджреВрд░ рднрд╛рдЧреЗ!",
    "ЁЯУЪ Baccho рдХреЛ bedtime pe moral story рд╕реБрдирд╛рдУ with extra cozy vibes!",
    "ЁЯзд Gloves рдкрд╣рди рдХрд░ snow drawing game рдЦреЗрд▓реЛ (chalk рд╕реЗ)!",
    "ЁЯСитАНЁЯН│ Sab milke ek winter special thali рдмрдирд╛рдУ!",
    "ЁЯОБ DIY wool gift banрд╛рдУ тАУ grandma рдХреЛ рджреЛ surprise!",
    "ЁЯЫПя╕П Bed heater рдХреЗ рдкрд╛рд╕ ek warm word chain game рдЦреЗрд▓реЛ!",
    "ЁЯзг Mummy рдХреА рдкреБрд░рд╛рдиреА shawl рдкрд╣рди рдХреЗ retro style photos рд▓реЛ!"
  ],
  default: [
    "ЁЯМИ Mausam рдЪрд╛рд╣реЗ рдЬреЛ рд╣реЛ тАУ masti toh har haal рдореЗрдВ рд╣реЛрдЧреА!",
    "ЁЯХ║ЁЯТГ Family dance-off rakho тАУ рдХреЛрдИ рднреА mood рд╣реЛ, beat toh banta hai!",
    "ЁЯОн Ghar рдореЗрдВ mini talent show рд░рдЦреЛ тАУ sab kuch perform рдХрд░реЗрдВ!",
    "ЁЯд│ Crazy creative family selfies рд▓реЛ тАУ background chahe kuch bhi рд╣реЛ!",
    "ЁЯЧ║я╕П Baccho рдХреЗ рд▓рд┐рдП treasure hunt setup karo тАУ clues рдмрдирд╛ рд▓реЛ!",
    "ЁЯОк Mini mela setup рдХрд░реЛ рдШрд░ рдореЗрдВ тАУ popcorn, stalls рдФрд░ games!",
    "ЁЯЦМя╕П Ek wall рдкрд░ sabki doodle art gallery рдмрдирд╛рдУ!",
    "ЁЯШВ Mummy рдХреА saree рд╕реЗ fashion ramp walk рдХрд░реЛ тАУ sab рд╣рдБрд╕реЗрдВрдЧреЗ!",
    "ЁЯУЭ Joke wall board рдмрдирд╛рдУ тАУ sab ek joke likреЗрдВ daily!",
    "ЁЯОм Ek short film рдмрдирд╛рдУ тАУ phone рд╕реЗ рд╣реА direction aur acting рдХрд░реЛ!",
    "ЁЯОо Tech-free game hour рд░рдЦреЛ тАУ рд╕рд┐рд░реНрдл classic games allowed!",
    "ЁЯзГ Sab milke ek unique drink recipe рдмрдирд╛рдУ рдФрд░ taste test рдХрд░реЛ!",
    "ЁЯУЪ Family ke favorite books ka shelf рдмрдирд╛рдУ aur review share рдХрд░реЛ!",
    "ЁЯО╝ Ek group song рдЧрд╛рдУ рдФрд░ рд╡реАрдбрд┐рдпреЛ рдмрдирд╛ рд▓реЛ!",
    "ЁЯЦ╝я╕П Purani family photos рдирд┐рдХрд▓ рдХреЗ nostalgia night рд░рдЦреЛ!",
    "ЁЯМН Ek chhota тАШWorld Tour at HomeтАЩ рдХрд░реЛ тАУ рд╣рд░ country рдХреА theme setup рдХрд░реЛ!",
    "ЁЯе│ Daily ek chhoti celebration рдХрд░реЛ тАУ bina wajah khushi!",
    "ЁЯкД Baccho ke рд╕рд╛рде magic tricks рд╕реАрдЦреЛ aur perform рдХрд░реЛ!",
    "ЁЯО▓ Family Olympics рд░рдЦреЛ тАУ рд╣рд░ рдХреЛрдИ ek game рд▓рд╛рдП!",
    "тЭдя╕П Ghar ka gratitude jar рдмрдирд╛рдУ тАУ sab roz ek рдЪреАрдЬрд╝ likреЗрдВ рдЬрд┐рд╕рдореЗрдВ рдЦреБрд╢реА рд╣реЛ!"
  ]
};

      // Audio context for handling autoplay restrictions
      let audioContext;
      let audioElement;
      let isMusicPlaying = false;
      let currentTrack = "";
      let audioInitialized = false;

      document.getElementById("year").textContent = new Date().getFullYear();
      let searchHistory =
        JSON.parse(localStorage.getItem("weatherHistory")) || [];

      function getRandomActivity(condition) {
        let activities;

        if (condition.includes("sun") || condition.includes("clear")) {
          activities = weatherActivities.sunny;
        } else if (
          condition.includes("rain") ||
          condition.includes("drizzle")
        ) {
          activities = weatherActivities.rainy;
        } else if (condition.includes("cloud")) {
          activities = weatherActivities.cloudy;
        } else if (condition.includes("cold") || condition.includes("snow")) {
          activities = weatherActivities.cold;
        } else {
          activities = weatherActivities.default;
        }

        return activities[Math.floor(Math.random() * activities.length)];
      }

      // Initialize audio system
      function initAudio() {
        if (audioInitialized) return;

        // Create audio element
        audioElement = new Audio();
        audioElement.loop = true;

        // Setup audio context
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const source = audioContext.createMediaElementSource(audioElement);
        source.connect(audioContext.destination);

        // Resume audio context when user interacts (to handle autoplay policies)
        document.addEventListener(
          "click",
          () => {
            if (audioContext.state === "suspended") {
              audioContext.resume();
            }
          },
          { once: true }
        );

        audioInitialized = true;
      }

      // Play weather-appropriate music
      function playWeatherMusic(condition) {
        if (!audioInitialized) initAudio();

        let musicFile;
        let musicName;

        if (condition.includes("sun") || condition.includes("clear")) {
          musicFile = "sounds/sunny.mp3";
          musicName = "тШАя╕П Sunny Day Music";
        } else if (
          condition.includes("rain") ||
          condition.includes("drizzle")
        ) {
          musicFile = "sounds/rain.mp3";
          musicName = "ЁЯМзя╕П Rainy Day Music";
        } else if (condition.includes("cloud")) {
          musicFile = "sounds/cloudy.mp3";
          musicName = "тШБя╕П Cloudy Day Music";
        } else if (condition.includes("cold") || condition.includes("snow")) {
          musicFile = "sounds/cold.mp3";
          musicName = "тЭДя╕П Cold Day Music";
        } else {
          musicFile = "sounds/default.mp3";
          musicName = "ЁЯМИ Weather Music";
        }

        // Only change if it's a new track
        if (currentTrack !== musicFile) {
          currentTrack = musicFile;
          audioElement.src = musicFile;
          document.getElementById("musicInfo").textContent = musicName;

          // Try to play (might fail due to autoplay policies)
          audioElement
            .play()
            .then(() => {
              isMusicPlaying = true;
              document.getElementById("musicControl").innerHTML =
                '<i class="fas fa-pause"></i>';
              document.getElementById("musicPlayer").style.display = "flex";
            })
            .catch((error) => {
              console.log(
                "Autoplay prevented, will play after user interaction"
              );
              isMusicPlaying = false;
              document.getElementById("musicControl").innerHTML =
                '<i class="fas fa-play"></i>';
              document.getElementById("musicPlayer").style.display = "flex";
            });
        } else if (isMusicPlaying) {
          // If same track and already playing, ensure controls are visible
          document.getElementById("musicPlayer").style.display = "flex";
        }
      }

      // Toggle music play/pause
      function toggleMusic() {
        if (!audioInitialized) initAudio();

        if (isMusicPlaying) {
          audioElement.pause();
          document.getElementById("musicControl").innerHTML =
            '<i class="fas fa-play"></i>';
        } else {
          audioElement
            .play()
            .then(() => {
              document.getElementById("musicControl").innerHTML =
                '<i class="fas fa-pause"></i>';
            })
            .catch((error) => {
              alert(
                "Please interact with the page first to allow audio playback"
              );
            });
        }
        isMusicPlaying = !isMusicPlaying;
      }

      async function getWeather(location = null) {
        const btn = document.getElementById("checkBtn");
        const input = document.getElementById("locationInput");

        if (!location) location = input.value.trim();
        if (!location) {
          alert("Yaar kuch toh likho! Sheher ka naam batao na ЁЯШК");
          return;
        }

        if (btn) {
          btn.disabled = true;
          btn.innerHTML =
            '<i class="fas fa-spinner fa-spin mr-2"></i> Dhundh raha hoon...';
        }

        if (location && !searchHistory.includes(location)) {
          searchHistory.unshift(location);
          if (searchHistory.length > 5) searchHistory.pop();
          localStorage.setItem("weatherHistory", JSON.stringify(searchHistory));
          updateHistory();
        }

        try {
          const res = await fetch(
            `https://api.weatherapi.com/v1/forecast.json?key=e9c43fcf2e9c4868a3b71728252106&q=${location}&days=1&aqi=yes`
          );
          if (!res.ok) throw new Error("API error");
          const data = await res.json();

          const condition = data.current.condition.text.toLowerCase();
          const emojiMap = {
            sunny: "тШАя╕П",
            clear: "тШАя╕П",
            "partly cloudy": "тЫЕ",
            cloudy: "тШБя╕П",
            overcast: "ЁЯМея╕П",
            mist: "ЁЯМля╕П",
            "patchy rain nearby": "ЁЯМжя╕П",
            "light rain": "ЁЯМзя╕П",
            "moderate rain": "ЁЯМзя╕П",
            "heavy rain": "тЫИя╕П",
            thunderstorm: "ЁЯМйя╕П",
            snow: "тЭДя╕П",
            fog: "ЁЯМБ",
            drizzle: "ЁЯМзя╕П",
          };

          const emoji = emojiMap[condition] || "ЁЯМИ";
          const background = getThemeFromCondition(condition);
          document.body.className =
            background +
            " min-h-screen flex flex-col items-center px-4 py-6 transition-all duration-500";

          const activity = getRandomActivity(condition);

          document.getElementById("weatherInfo").innerHTML = `
          <div class="bg-white/30 backdrop-blur-md rounded-2xl p-6 shadow-xl mt-6 w-full max-w-md animate-fadeIn text-gray-900">
            <div class="flex items-center justify-between">
              <div>
                <h2 class="text-2xl font-bold">ЁЯПЩя╕П ${data.location.name}, ${
            data.location.region
          }</h2>
                <p class="text-sm text-gray-700">ЁЯМП ${
                  data.location.country
                } | ЁЯХ░я╕П ${data.location.localtime}</p>
              </div>
              <img src="${
                data.current.condition.icon
              }" alt="weather icon" class="w-16 h-16">
            </div>
            
            <div class="mt-4">
              <p class="text-xl font-semibold">${emoji} ${
            data.current.temp_c
          }┬░C - ${data.current.condition.text}</p>
              <p class="text-sm text-gray-800 mt-2">ЁЯТи Hawa: ${
                data.current.wind_kph
              } kph (${data.current.wind_dir})</p>
              <p class="text-sm text-gray-800">ЁЯТз Nami: ${
                data.current.humidity
              }% | ЁЯШЕ Mehsoos: ${data.current.feelslike_c}┬░C</p>
              <p class="text-sm text-gray-800">тШАя╕П UV: ${
                data.current.uv
              } | ЁЯПн AQI: ${
            data.current.air_quality?.pm2_5?.toFixed(1) || "NA"
          }</p>
            </div>
            
            <div class="himanshu-bubble animate-fadeIn">
              <p class="font-bold text-blue-800">Himanshu Says ЁЯЧгя╕П :</p>
              <p class="text-gray-800">"${activity}"</p>
            </div>
            
            <canvas id="forecastChart" class="mt-4" height="120"></canvas>
            
            <div class="mt-4 text-sm text-gray-600">
              <p>ЁЯУК Pressure: ${data.current.pressure_mb} mb</p>
              <p>ЁЯСА Visibility: ${data.current.vis_km} km | тШБя╕П Badal: ${
            data.current.cloud
          }%</p>
            </div>
          </div>
        `;

          // Play weather-appropriate music
          playWeatherMusic(condition);

          // Hourly forecast chart
          const labels = data.forecast.forecastday[0].hour.map(
            (h) => h.time.split(" ")[1]
          );
          const temps = data.forecast.forecastday[0].hour.map((h) => h.temp_c);
          const ctx = document.getElementById("forecastChart").getContext("2d");
          new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Har ghante ka temperature (┬░C)",
                  data: temps,
                  borderColor: "#2563eb",
                  backgroundColor: "#93c5fd",
                  tension: 0.4,
                  fill: true,
                },
              ],
            },
            options: {
              responsive: true,
              plugins: { legend: { display: false } },
              scales: {
                y: { beginAtZero: false },
              },
            },
          });
        } catch (err) {
          document.getElementById("weatherInfo").innerHTML = `
          <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mt-6 rounded animate-fadeIn" role="alert">
            <p class="font-bold">Oops! Kuch toh gadbad hai</p>
            <p>Yaar location sahi se likho na, nahi mil raha. Koi aur jagah try karo!</p>
          </div>
        `;
        } finally {
          if (btn) {
            btn.disabled = false;
            btn.innerHTML =
              '<i class="fas fa-cloud-sun mr-2"></i> Pata Karo Mausam Ka!';
          }
        }
      }

      function getThemeFromCondition(condition) {
        if (condition.includes("rain"))
          return "bg-gradient-to-br from-blue-800 via-blue-600 to-blue-400";
        if (condition.includes("sun") || condition.includes("clear"))
          return "bg-gradient-to-br from-yellow-200 via-yellow-300 to-yellow-400";
        if (condition.includes("cloud"))
          return "bg-gradient-to-br from-gray-300 via-gray-400 to-gray-500";
        if (condition.includes("snow"))
          return "bg-gradient-to-br from-blue-100 via-white to-blue-200";
        if (condition.includes("cold"))
          return "bg-gradient-to-br from-blue-200 via-blue-300 to-blue-400";
        return "bg-gradient-to-br from-blue-100 via-blue-200 to-blue-300";
      }

      function updateHistory() {
        const container = document.getElementById("history");
        container.innerHTML = searchHistory
          .map(
            (loc) =>
              `<button onclick="getWeather('${loc}')" class="px-3 py-1 bg-white/40 text-sm rounded-full shadow hover:bg-white/60 transition">${loc}</button>`
          )
          .join(" ");
      }

      async function autoSuggest(query) {
        const suggestionsBox = document.getElementById("suggestions");
        if (!query || query.length < 2) {
          suggestionsBox.classList.add("hidden");
          return;
        }

        try {
          const res = await fetch(
            `https://api.weatherapi.com/v1/search.json?key=e9c43fcf2e9c4868a3b71728252106&q=${query}`
          );
          if (!res.ok) throw new Error("API error");
          const data = await res.json();

          if (data.length === 0) {
            suggestionsBox.classList.add("hidden");
            return;
          }

          suggestionsBox.innerHTML = data
            .map(
              (loc) =>
                `<div onclick="selectCity('${loc.name}, ${loc.region}')">${loc.name}, ${loc.region} (${loc.country})</div>`
            )
            .join("");
          suggestionsBox.classList.remove("hidden");
        } catch (err) {
          suggestionsBox.classList.add("hidden");
        }
      }

      function selectCity(city) {
        document.getElementById("locationInput").value = city.split(",")[0];
        document.getElementById("suggestions").classList.add("hidden");
        getWeather(city);
      }

      document.addEventListener("click", (e) => {
        if (
          !document.getElementById("locationInput").contains(e.target) &&
          !document.getElementById("suggestions").contains(e.target)
        ) {
          document.getElementById("suggestions").classList.add("hidden");
        }
      });

      window.onload = () => {
        updateHistory();
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            async (pos) => {
              const lat = pos.coords.latitude;
              const lon = pos.coords.longitude;
              await getWeather(`${lat},${lon}`);
            },
            () => {
              // Default to Delhi if location access denied
              getWeather("jaithra");
            }
          );
        } else {
          getWeather("jaithra");
        }
      };

      function startVoice() {
        const recognition = new (window.SpeechRecognition ||
          window.webkitSpeechRecognition)();
        recognition.lang = "en-IN";
        recognition.start();
        recognition.onresult = (event) => {
          document.getElementById("locationInput").value =
            event.results[0][0].transcript;
          getWeather();
        };
      }
    </script>
  </body>
</html>
