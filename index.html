<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />
  <meta name="theme-color" content="#38bdf8" />
  <meta name="description" content="HawaBaazi - India‚Äôs coolest weather app that suggests fun activities and music based on live weather conditions." />
  <meta name="keywords" content="weather app, HawaBaazi, weather forecast, fun weather app, weather activities, music by weather, Himanshu Yadav" />
  <meta name="author" content="Himanshu Yadav" />

  <!-- Open Graph / Facebook -->
  <meta property="og:title" content="HawaBaazi - Fun Weather App with Music & Activities!" />
  <meta property="og:description" content="Check the weather and get fun suggestions with music! HawaBaazi is a beautiful and interactive weather app made for India." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://hawabaazi.onrender.com" />
  <meta property="og:image" content="https://hawabaazi.onrender.com/static/og-preview.png" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="HawaBaazi - Weather + Music + Fun" />
  <meta name="twitter:description" content="Weather-based activity suggestions, fun messages, and perfect background music ‚Äì all in one app!" />
  <meta name="twitter:image" content="https://hawabaazi.onrender.com/static/og-preview.png" />

  <!-- Favicon -->
  <link rel="icon" href="/static/favicon.png" type="image/png" />

  <!-- Title -->
  <title>HawaBaazi üòÖ ‚òÅÔ∏è | Your Fun Weather Companion</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Structured Data / Schema.org -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "HawaBaazi",
    "url": "https://hawabaazi.onrender.com",
    "description": "HawaBaazi is a unique weather app that suggests activities and music based on current weather.",
    "applicationCategory": "WeatherApp",
    "creator": {
      "@type": "Person",
      "name": "Himanshu Yadav"
    }
  }
  </script>
 <style>
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        .animate-fadeIn {
          animation: fadeIn 0.6s ease-in-out;
        }
    
        @keyframes pulse {
          0%, 100% {
            transform: scale(1);
            box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
          }
          50% {
            transform: scale(1.05);
            box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
          }
        }
        .animate-pulse-ring {
          animation: pulse 1.5s infinite;
        }
    
        #suggestions {
          position: absolute;
          z-index: 50;
          background: white;
          width: 100%;
          border-radius: 0.5rem;
          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
          overflow: auto;
          max-height: 200px;
        }
        #suggestions div {
          padding: 0.5rem 1rem;
          cursor: pointer;
        }
        #suggestions div:hover {
          background-color: #e2e8f0;
        }
    
        .himanshu-bubble {
          position: relative;
          background: #f8fafc;
          border-radius: 1rem;
          padding: 1rem;
          margin-top: 1rem;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .himanshu-bubble:after {
          content: "";
          position: absolute;
          top: -10px;
          left: 20px;
          border-width: 0 10px 10px;
          border-style: solid;
          border-color: #f8fafc transparent;
        }
    
        /* Music player styles */
        #musicPlayer {
          position: fixed;
          bottom: 20px;
          right: 20px;
          background: rgba(255, 255, 255, 0.8);
          backdrop-filter: blur(10px);
          border-radius: 50px;
          padding: 8px 15px;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
          display: flex;
          align-items: center;
          gap: 10px;
          z-index: 1000;
          transition: all 0.3s ease;
        }
        #musicPlayer:hover {
          background: rgba(255, 255, 255, 0.95);
        }
        #musicControl {
          background: none;
          border: none;
          font-size: 1.2rem;
          cursor: pointer;
          color: #3b82f6;
          transition: transform 0.2s;
        }
        #musicControl:hover {
          transform: scale(1.1);
        }
        #musicInfo {
          font-size: 0.8rem;
          color: #333;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          max-width: 0;
          transition: max-width 0.3s ease;
        }
        #musicPlayer:hover #musicInfo {
          max-width: 200px;
        }
    
        /* Weather Theme Classes */
        .theme-sunny {
          background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
        }
        .theme-rainy {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .theme-cloudy {
          background: linear-gradient(135deg, #bdc3c7 0%, #2c3e50 100%);
        }
        .theme-snowy {
          background: linear-gradient(135deg, #e6e9f0 0%, #eef1f5 100%);
        }
        .theme-thunder {
          background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
        }
        .theme-default {
          background: linear-gradient(135deg, #00c6fb 0%, #005bea 100%);
        }
   /* Weather Effects */
.weather-container {
  position: relative;
  overflow: hidden;
}

.rain {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  pointer-events: none;
  z-index: 1;
}

.drop {
  position: absolute;
  width: 2px;
  height: 15px;
  background: linear-gradient(transparent, rgba(173, 216, 230, 0.8));
  border-radius: 0 0 5px 5px;
  animation: falling linear infinite;
  transform-origin: top;
}

@keyframes falling {
  0% {
    transform: translateY(-20px) rotate(10deg);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  80% {
    opacity: 0.8;
  }
  100% {
    transform: translateY(100vh) rotate(10deg);
    opacity: 0;
  }
}

/* Splash effect when rain hits bottom */
.drop::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: -1px;
  width: 4px;
  height: 2px;
  background: rgba(173, 216, 230, 0.3);
  border-radius: 50%;
  opacity: 0;
  animation: splash 0.5s ease-out infinite;
  animation-delay: inherit;
}

@keyframes splash {
  0% {
    transform: scale(0);
    opacity: 0;
  }
  50% {
    opacity: 0.3;
  }
  100% {
    transform: scale(2);
    opacity: 0;
  }
}

.snow {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  pointer-events: none;
  z-index: 1;
}

.flake {
  position: absolute;
  width: 8px;
  height: 8px;
  background: white;
  border-radius: 50%;
  filter: blur(1px);
  animation: snow-fall linear infinite;
}

@keyframes snow-fall {
  0% {
    transform: translateY(-10px) translateX(0);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  90% {
    opacity: 1;
  }
  100% {
    transform: translateY(100px) translateX(20px);
    opacity: 0;
  }
}
    </style>
</head>

<body class="theme-default min-h-screen flex flex-col items-center justify-center px-4 py-10 transition-all duration-500 font-sans">
    <div class="w-full max-w-2xl mx-auto">
        <div class="text-center w-full">
            <h1 class="text-5xl font-extrabold mb-2 text-blue-900 drop-shadow-md tracking-wide">
        ‚õÖHawaBaazi
      </h1>
            <p class="text-sm text-white-800 font-medium mb-6 opacity-90">
                Weather App || By Himanshu Yadav
            </p>

            <!-- Input + Suggestions -->
            <div class="relative w-full max-w-md mx-auto mb-6 group">
                <div class="relative bg-white/30 backdrop-blur-lg border border-white/50 rounded-xl shadow-xl transition-all duration-300 focus-within:ring-2 focus-within:ring-blue-400">
                    <input id="locationInput" type="text" oninput="autoSuggest(this.value)" placeholder="üåÜ Enter Your City Name..." class="peer px-5 py-3 w-full bg-transparent rounded-xl focus:outline-none text-lg text-gray-800 placeholder-gray-700 font-medium transition-all duration-300 tracking-wide"
                    />
                    <!-- Voice Search Button -->
                    <button id="voiceBtn" onclick="startVoice()" class="absolute right-3 top-1/2 -translate-y-1/2 text-blue-600 hover:text-blue-800 text-xl transition-transform" title="Voice Search">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
                <div id="suggestions" class="hidden mt-1 z-50"></div>
            </div>

            <!-- Animated Button -->
            <div class="flex justify-center w-full mb-6">
                <button id="checkBtn" onclick="getWeather()" class="px-7 py-3 rounded-full bg-gradient-to-r from-blue-500 via-indigo-500 to-blue-600 hover:from-indigo-600 hover:to-blue-700 transition-all duration-300 text-white font-bold shadow-lg shadow-blue-300/50 hover:shadow-xl hover:scale-105">
                    <i class="fas fa-cloud-sun mr-2 animate-pulse"></i> check weather..üå°Ô∏è
                </button>
            </div>

            <!-- Search History -->
            <div id="history" class="flex flex-wrap gap-2 justify-center mb-6 w-full"></div>

            <!-- Weather Info -->
            <div id="weatherInfo" class="w-full flex justify-center"></div>
        </div>
    </div>

    <!-- Music Player (initially hidden) -->
    <div id="musicPlayer" style="display: none">
        <button id="musicControl" onclick="toggleMusic()">
            <i class="fas fa-play"></i>
        </button>
        <span id="musicInfo">Weather Music</span>
    </div>

    <!-- Footer -->
    <footer class="mt-10 bg-white/30 backdrop-blur-md rounded-2xl p-5 shadow-xl w-full max-w-md mx-auto animate-fadeIn">
        <div class="flex flex-col items-center gap-3 text-center">
            <h3 class="text-xl font-semibold text-gray-800">
        Designed with ‚ù§Ô∏è by Himanshu Yadav
      </h3>

            <div class="flex flex-wrap justify-center gap-4 mt-2">
                <a href="https://instagram.com/himanshu_yadav479" target="_blank" class="flex items-center gap-2 px-4 py-1.5 bg-pink-100 rounded-full hover:bg-pink-200 transition">
                    <i class="fab fa-instagram text-pink-600 text-lg hover:scale-125 duration-300"></i>
                    <span class="text-sm font-medium text-gray-800">Instagram</span>
                </a>
                <a href="https://wa.me/918534866350" target="_blank" class="flex items-center gap-2 px-4 py-1.5 bg-green-100 rounded-full hover:bg-green-200 transition">
                    <i class="fab fa-whatsapp text-green-600 text-lg hover:scale-125 duration-300"></i>
                    <span class="text-sm font-medium text-gray-800">WhatsApp</span>
                </a>
            </div>

            <a href="tel:+918534866350" class="flex items-center gap-2 px-4 py-1.5 bg-blue-100 rounded-full hover:bg-blue-200 transition">
                <i class="fas fa-phone-alt text-blue-600 text-sm hover:scale-125 duration-300"></i>
                <span class="text-sm font-medium text-gray-800">Call Me</span>
            </a>

            <a href="mailto:azp729012@gmail.com" class="text-xs text-blue-700 underline hover:text-blue-900 transition">Send Feedback</a
      >

      <p class="text-sm text-gray-600 mt-2">
        ¬© <span id="year"></span> All Rights Reserved
      </p>
    </div>
  </div>

  <script>
    // Weather activities will be loaded from JSON
    let weatherActivities = {};

    // Load activities from JSON file
    fetch('weatherActivities.json')
      .then(response => {
        if (!response.ok) {
          throw new Error('Failed to load activities');
        }
        return response.json();
      })
      .then(data => {
        weatherActivities = data;
        console.log("Weather activities loaded successfully");
      })
      .catch(error => {
        console.error("Error loading activities:", error);
        // Fallback activities if JSON fails to load
        weatherActivities = {
          default: {
            day: ["Check the weather for today's suggestions"],
            night: ["Check the weather for tonight's suggestions"]
          }
        };
      });

    // Utility function to get random activity
    function getRandomActivity(condition) {
      let type;
      if (condition.includes("sun") || condition.includes("clear")) {
        type = "sunny";
      } else if (condition.includes("rain") || condition.includes("drizzle")) {
        type = "rainy";
      } else if (condition.includes("cloud")) {
        type = "cloudy";
      } else if (condition.includes("cold") || condition.includes("snow")) {
        type = "cold";
      } else {
        type = "default";
      }

      const currentHour = new Date().getHours();
      const timeOfDay = currentHour >= 6 && currentHour < 18 ? "day" : "night";

      // Safely get activities with fallbacks
      const activities = weatherActivities[type]?.[timeOfDay] || 
                        weatherActivities.default?.[timeOfDay] || 
                        ["Enjoy your day!"];

      // Remove any existing quotes from the activity message
      const activity = activities[Math.floor(Math.random() * activities.length)];
      return activity.replace(/[""]/g, '');
    }

    // Initialize audio system - PRO VERSION
    let audioContext;
    let audioElement;
    let isMusicPlaying = false;
    let currentTrack = "";
    let audioInitialized = false;
    let audioInteractionRegistered = false;

    function initAudio() {
      if (audioInitialized) return;

      // Create audio element with better error handling
      audioElement = new Audio();
      audioElement.loop = true;
      audioElement.preload = "auto";
      
      // Handle audio errors
      audioElement.addEventListener('error', () => {
        console.error("Audio loading error:", audioElement.error);
      });

      // Setup audio context with better compatibility
      try {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const source = audioContext.createMediaElementSource(audioElement);
        source.connect(audioContext.destination);
      } catch (e) {
        console.error("AudioContext failed:", e);
        return;
      }

      // Handle audio autoplay policy with multiple interaction types
      const handleUserInteraction = () => {
        if (audioContext.state === 'suspended') {
          audioContext.resume().then(() => {
            console.log("AudioContext resumed successfully");
            audioInteractionRegistered = true;
          }).catch(e => {
            console.error("AudioContext resume failed:", e);
          });
        }
      };

      // Add multiple event listeners for better compatibility
      const interactionEvents = ['click', 'touchstart', 'keydown', 'mousedown'];
      interactionEvents.forEach(event => {
        document.addEventListener(event, handleUserInteraction, { once: true });
      });

      audioInitialized = true;
    }

    // Play weather-appropriate music - PRO VERSION
    function playWeatherMusic(condition) {
      if (!audioInitialized) initAudio();

      let musicFile;
      let musicName;

      // Music selection based on weather
      if (condition.includes("sun") || condition.includes("clear")) {
        musicFile = "sounds/sunny.mp3";
        musicName = "‚òÄÔ∏è Sunny Day Music";
      } else if (condition.includes("rain") || condition.includes("drizzle")) {
        musicFile = "sounds/rain.mp3";
        musicName = "üåßÔ∏è Rainy Day Music";
      } else if (condition.includes("cloud")) {
        musicFile = "sounds/cloudy.mp3";
        musicName = "‚òÅÔ∏è Cloudy Day Music";
      } else if (condition.includes("cold") || condition.includes("snow")) {
        musicFile = "sounds/cold.mp3";
        musicName = "‚ùÑÔ∏è Cold Day Music";
      } else {
        musicFile = "sounds/default.mp3";
        musicName = "üåà Weather Music";
      }

      // Only change if it's a new track
      if (currentTrack !== musicFile) {
        currentTrack = musicFile;
        audioElement.src = musicFile;
        document.getElementById("musicInfo").textContent = musicName;

        const playAudioWithRetry = () => {
          // Ensure audio context is ready
          if (audioContext.state === 'suspended') {
            audioContext.resume().then(() => {
              audioElement.play().then(() => {
                isMusicPlaying = true;
                updateMusicControls();
              }).catch(playError => {
                console.log("Playback failed, will retry:", playError);
                scheduleRetry();
              });
            }).catch(resumeError => {
              console.log("AudioContext resume failed:", resumeError);
              scheduleRetry();
            });
          } else {
            audioElement.play().then(() => {
              isMusicPlaying = true;
              updateMusicControls();
            }).catch(playError => {
              console.log("Playback failed, will retry:", playError);
              scheduleRetry();
            });
          }
        };

        const scheduleRetry = () => {
          setTimeout(() => {
            if (!isMusicPlaying) {
              playAudioWithRetry();
            }
          }, 500);
        };

        const updateMusicControls = () => {
          document.getElementById("musicControl").innerHTML = 
            isMusicPlaying ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play"></i>';
          document.getElementById("musicPlayer").style.display = "flex";
        };

        // Initial play attempt
        playAudioWithRetry();
      } else if (isMusicPlaying) {
        // If same track and already playing, ensure controls are visible
        document.getElementById("musicPlayer").style.display = "flex";
      }
    }

    // Toggle music play/pause - PRO VERSION
    function toggleMusic() {
      if (!audioInitialized) initAudio();

      const handlePlay = () => {
        // First ensure audio context is running
        if (audioContext.state === 'suspended') {
          audioContext.resume().then(() => {
            audioElement.play().then(() => {
              isMusicPlaying = true;
              updateControls();
            }).catch(playError => {
              console.log("Play failed after resume:", playError);
              isMusicPlaying = false;
              updateControls();
            });
          }).catch(resumeError => {
            console.log("Resume failed:", resumeError);
            isMusicPlaying = false;
            updateControls();
          });
        } else {
          audioElement.play().then(() => {
            isMusicPlaying = true;
            updateControls();
          }).catch(playError => {
            console.log("Direct play failed:", playError);
            isMusicPlaying = false;
            updateControls();
          });
        }
      };

      const updateControls = () => {
        document.getElementById("musicControl").innerHTML = 
          isMusicPlaying ? '<i class="fas fa-pause"></i>' : '<i class="fas fa-play"></i>';
      };

      if (isMusicPlaying) {
        audioElement.pause();
        isMusicPlaying = false;
        updateControls();
      } else {
        handlePlay();
      }
    }

    document.getElementById("year").textContent = new Date().getFullYear();
    let searchHistory = JSON.parse(localStorage.getItem("weatherHistory")) || [];

    // Create more realistic rain drops
function createRainDrops(container, count = 150) {
  container.innerHTML = '';
  
  for (let i = 0; i < count; i++) {
    const drop = document.createElement('div');
    drop.className = 'drop';
    
    // Randomize drop properties
    const dropHeight = 10 + Math.random() * 10;
    const dropWidth = 1 + Math.random() * 1.5;
    const dropOpacity = 0.6 + Math.random() * 0.4;
    
    drop.style.height = `${dropHeight}px`;
    drop.style.width = `${dropWidth}px`;
    drop.style.left = `${Math.random() * 100}%`;
    drop.style.animationDuration = `${0.4 + Math.random() * 0.6}s`;
    drop.style.animationDelay = `${Math.random() * 0.5}s`;
    drop.style.opacity = dropOpacity;
    
    // Make drops bigger and faster for heavy rain
    if (count > 100) {
      drop.style.width = `${2 + Math.random() * 3}px`;
      drop.style.height = `${15 + Math.random() * 10}px`;
      drop.style.animationDuration = `${0.3 + Math.random() * 0.4}s`;
    }
    
    container.appendChild(drop);
  }
}

// Create snow flakes
function createSnowFlakes(container, count = 50) {
  container.innerHTML = '';
  
  for (let i = 0; i < count; i++) {
    const flake = document.createElement('div');
    flake.className = 'flake';
    
    // Randomize flake properties
    const flakeSize = 4 + Math.random() * 6;
    flake.style.width = `${flakeSize}px`;
    flake.style.height = `${flakeSize}px`;
    flake.style.left = `${Math.random() * 100}%`;
    flake.style.animationDuration = `${3 + Math.random() * 5}s`;
    flake.style.animationDelay = `${Math.random() * 5}s`;
    flake.style.opacity = `${0.3 + Math.random() * 0.7}`;
    
    container.appendChild(flake);
  }
}
   

    async function getWeather(location = null) {
      const btn = document.getElementById("checkBtn");
      const input = document.getElementById("locationInput");

      if (!location) location = input.value.trim();
      if (!location) {
        alert("Yaar kuch toh likho! Sheher ka naam batao na üòä");
        return;
      }

      if (btn) {
        btn.disabled = true;
        btn.innerHTML =
          '<i class="fas fa-spinner fa-spin mr-2"></i> checking...';
      }

      if (location && !searchHistory.includes(location)) {
        searchHistory.unshift(location);
        if (searchHistory.length > 5) searchHistory.pop();
        localStorage.setItem("weatherHistory", JSON.stringify(searchHistory));
        updateHistory();
      }

      try {
        const res = await fetch(
          `https://api.weatherapi.com/v1/forecast.json?key=e9c43fcf2e9c4868a3b71728252106&q=${location}&days=1&aqi=yes`
        );
        if (!res.ok) throw new Error("API error");
        const data = await res.json();

        const condition = data.current.condition.text.toLowerCase();
        const emojiMap = {
          sunny: "‚òÄÔ∏è",
          clear: "‚òÄÔ∏è",
          "partly cloudy": "‚õÖ",
          cloudy: "‚òÅÔ∏è",
          overcast: "üå•Ô∏è",
          mist: "üå´Ô∏è",
          "patchy rain nearby": "üå¶Ô∏è",
          "light rain": "üåßÔ∏è",
          "moderate rain": "üåßÔ∏è",
          "heavy rain": "‚õàÔ∏è",
          thunderstorm: "üå©Ô∏è",
          snow: "‚ùÑÔ∏è",
          fog: "üåÅ",
          drizzle: "üåßÔ∏è",
        };

        const emoji = emojiMap[condition] || "üåà";
        const theme = getThemeFromCondition(condition);
        document.body.className = theme + 
          " min-h-screen flex flex-col items-center justify-center px-4 py-10 transition-all duration-500 font-sans";

        // Create weather container
        const weatherContainer = document.createElement('div');
        weatherContainer.className = 'weather-container bg-white/30 backdrop-blur-md rounded-2xl p-6 shadow-xl w-full max-w-md animate-fadeIn text-gray-900 relative';
        
        // Create effects container
        const effectsContainer = document.createElement('div');
        effectsContainer.className = 'absolute w-full h-full top-0 left-0 pointer-events-none overflow-hidden';
        
        // Add rain or snow effect based on condition
        if (condition.includes("rain") || condition.includes("drizzle")) {
          const rainDiv = document.createElement('div');
          rainDiv.className = 'rain';
          effectsContainer.appendChild(rainDiv);
          
          // Adjust number of drops based on rain intensity
          let dropCount = 150; // light rain
          if (condition.includes("moderate")) dropCount = 200;
          if (condition.includes("heavy") || condition.includes("torrential")) dropCount = 250;
          
          createRainDrops(rainDiv, dropCount);
        }
        else if (condition.includes("snow")) {
          const snowDiv = document.createElement('div');
          snowDiv.className = 'snow';
          effectsContainer.appendChild(snowDiv);
          
          createSnowFlakes(snowDiv);
        }

        const activity = getRandomActivity(condition);

        // Add weather content
        weatherContainer.innerHTML = `
          <div class="relative z-10">
            <div class="flex items-center justify-between">
              <div>
                <h2 class="text-2xl font-bold">üèôÔ∏è ${data.location.name}, ${data.location.region}</h2>
                <p class="text-sm text-gray-700">üåè ${data.location.country} | üï∞Ô∏è ${data.location.localtime}</p>
              </div>
              <img src="${data.current.condition.icon}" alt="weather icon" class="w-16 h-16">
            </div>
            
            <div class="mt-4">
              <p class="text-xl font-semibold">${emoji} ${data.current.temp_c}¬∞C - ${data.current.condition.text}</p>
              <p class="text-sm text-gray-800 mt-2">üí® Hawa: ${data.current.wind_kph} kph (${data.current.wind_dir})</p>
              <p class="text-sm text-gray-800">üíß Nami: ${data.current.humidity}% | üòÖ Mehsoos: ${data.current.feelslike_c}¬∞C</p>
              <p class="text-sm text-gray-800">‚òÄÔ∏è UV: ${data.current.uv} | üè≠ AQI: ${data.current.air_quality?.pm2_5?.toFixed(1) || "NA"}</p>
            </div>
            
            <div class="himanshu-bubble animate-fadeIn">
              <p class="font-bold text-blue-800">Himanshu Advice üó£Ô∏è :</p>
              <p class="text-gray-800">${activity}</p>
            </div>
            
            <canvas id="forecastChart" class="mt-4 w-full" height="120"></canvas>
            
            <div class="mt-4 text-sm text-gray-600">
              <p>üìä Pressure: ${data.current.pressure_mb} mb</p>
              <p>üëÄ Visibility: ${data.current.vis_km} km | ‚òÅÔ∏è Badal: ${data.current.cloud}%</p>
            </div>
          </div>
        `;

        // Add effects to container
        weatherContainer.appendChild(effectsContainer);
        
        // Add to DOM
        document.getElementById("weatherInfo").innerHTML = '';
        document.getElementById("weatherInfo").appendChild(weatherContainer);

        // Play weather-appropriate music
        playWeatherMusic(condition);

        // Hourly forecast chart
        const labels = data.forecast.forecastday[0].hour.map(
          (h) => h.time.split(" ")[1]
        );
        const temps = data.forecast.forecastday[0].hour.map((h) => h.temp_c);
        const ctx = document.getElementById("forecastChart").getContext("2d");
        new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                label: "hourly temperature..üå°Ô∏è (¬∞C)",
                data: temps,
                borderColor: "#2563eb",
                backgroundColor: "#93c5fd",
                tension: 0.4,
                fill: true,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
              y: { beginAtZero: false },
            },
          },
        });
      } catch (err) {
        document.getElementById("weatherInfo").innerHTML = `
        <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded animate-fadeIn" role="alert">
          <p class="font-bold">Oops! Kuch toh gadbad hai</p>
          <p>Yaar location sahi se likho na, nahi mil raha. Koi aur jagah try karo!</p>
        </div>
      `;
      } finally {
        if (btn) {
          btn.disabled = false;
          btn.innerHTML =
            '<i class="fas fa-cloud-sun mr-2"></i> check weather...üå°Ô∏è';
        }
      }
    }

    function getThemeFromCondition(condition) {
      condition = condition.toLowerCase();
      
      if (condition.includes("rain") || condition.includes("drizzle")) {
        return "theme-rainy";
      } 
      else if (condition.includes("sun") || condition.includes("clear")) {
        return "theme-sunny";
      }
      else if (condition.includes("cloud")) {
        return "theme-cloudy";
      }
      else if (condition.includes("snow") || condition.includes("ice")) {
        return "theme-snowy";
      }
      else if (condition.includes("thunder") || condition.includes("storm")) {
        return "theme-thunder";
      }
      else {
        return "theme-default";
      }
    }

    function updateHistory() {
      const container = document.getElementById("history");
      container.innerHTML = searchHistory
        .map(
          (loc) =>
            `<button onclick="getWeather('${loc}')" class="px-3 py-1 bg-white/40 text-sm rounded-full shadow hover:bg-white/60 transition">${loc}</button>`
        )
        .join(" ");
    }

    async function autoSuggest(query) {
      const suggestionsBox = document.getElementById("suggestions");
      if (!query || query.length < 2) {
        suggestionsBox.classList.add("hidden");
        return;
      }

      try {
        const res = await fetch(
          `https://api.weatherapi.com/v1/search.json?key=e9c43fcf2e9c4868a3b71728252106&q=${query}`
        );
        if (!res.ok) throw new Error("API error");
        const data = await res.json();

        if (data.length === 0) {
          suggestionsBox.classList.add("hidden");
          return;
        }

        suggestionsBox.innerHTML = data
          .map(
            (loc) =>
              `<div onclick="selectCity('${loc.name}, ${loc.region}')">${loc.name}, ${loc.region} (${loc.country})</div>`
          )
          .join("");
        suggestionsBox.classList.remove("hidden");
      } catch (err) {
        suggestionsBox.classList.add("hidden");
      }
    }

    function selectCity(city) {
      document.getElementById("locationInput").value = city.split(",")[0];
      document.getElementById("suggestions").classList.add("hidden");
      getWeather(city);
    }

    document.addEventListener("click", (e) => {
      if (
        !document.getElementById("locationInput").contains(e.target) &&
        !document.getElementById("suggestions").contains(e.target)
      ) {
        document.getElementById("suggestions").classList.add("hidden");
      }
    });

    function startVoice() {
      // Pause music if playing
      if (isMusicPlaying) {
        toggleMusic();
      }

      const voiceBtn = document.getElementById("voiceBtn");
      voiceBtn.innerHTML = '<i class="fas fa-microphone animate-pulse-ring"></i>';
      voiceBtn.classList.add("animate-pulse-ring");
      
      const recognition = new (window.SpeechRecognition ||
        window.webkitSpeechRecognition)();
      recognition.lang = "en-IN";
      recognition.start();
      
      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById("locationInput").value = transcript;
        voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
        voiceBtn.classList.remove("animate-pulse-ring");
        getWeather();
      };
      
      recognition.onerror = (event) => {
        console.error("Voice recognition error", event.error);
        voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
        voiceBtn.classList.remove("animate-pulse-ring");
        alert("Voice recognition failed. Please try again.");
        
        // Resume music if it was playing before
        if (isMusicPlaying) {
          toggleMusic();
        }
      };
      
      recognition.onend = () => {
        voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
        voiceBtn.classList.remove("animate-pulse-ring");
        
        // Resume music if no input was received
        if (!document.getElementById("locationInput").value && isMusicPlaying) {
          toggleMusic();
        }
      };
    }

    window.onload = () => {
      updateHistory();
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          async (pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            await getWeather(`${lat},${lon}`);
          },
          () => {
            // Default to Delhi if location access denied
            getWeather("jaithra");
          }
        );
      } else {
        getWeather("jaithra");
      }
    };
  </script>
</body>
</html>
